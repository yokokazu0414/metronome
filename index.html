<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>„Ç®„Éü„É™„Ç¢„Éî„Ç¢„ÉéÊïôÂÆ§ „É°„Éà„É≠„Éé„Éº„É†</title>
<style>
  :root{
    --primary: #e8b4d4;
    --primary-dark: #d698c0;
    --secondary: #f5e6d3;
    --accent: #c8a2c8;
    --bg-gradient: linear-gradient(135deg, #faf7f4 0%, #f0e8e4 50%, #ede4e8 100%);
    --panel-bg: rgba(255, 255, 255, 0.85);
    --panel-border: rgba(232, 180, 212, 0.3);
    --text-dark: #4a3c4a;
    --text-medium: #6b5b6b;
    --text-light: #8b7a8b;
    --shadow: 0 8px 32px rgba(200, 162, 200, 0.2);
    --shadow-small: 0 4px 16px rgba(200, 162, 200, 0.15);
  }
  
  *,*::before,*::after{ box-sizing:border-box }
  
  html,body{
    margin:0; padding:0; width:100%; max-width:100%; overflow-x:hidden;
    background: var(--bg-gradient);
    color: var(--text-dark);
    font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Yu Gothic Medium", "Meiryo", sans-serif;
    min-height: 100vh;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  .piano-pattern {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 120px;
    background: linear-gradient(45deg, 
      transparent 25%, rgba(232, 180, 212, 0.03) 25%, 
      rgba(232, 180, 212, 0.03) 50%, transparent 50%, 
      transparent 75%, rgba(232, 180, 212, 0.03) 75%);
    background-size: 40px 40px;
    z-index: -1;
    opacity: 0.3;
  }

  .app{ 
    max-width: 380px; 
    margin: 0 auto; 
    padding: max(20px, env(safe-area-inset-top) + 10px) 20px calc(env(safe-area-inset-bottom) + 20px);
    position: relative;
    z-index: 1;
  }

  .header {
    text-align: center;
    margin-bottom: 30px;
    padding-top: 20px;
  }

  .title {
    font-size: 26px;
    font-weight: 700;
    background: linear-gradient(45deg, var(--primary-dark), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 0 0 8px 0;
    letter-spacing: 0.5px;
  }

  .subtitle {
    font-size: 16px;
    color: var(--text-medium);
    margin: 0 0 4px 0;
    font-weight: 500;
  }

  .author {
    font-size: 11px;
    color: var(--text-light);
    opacity: 0.7;
    font-weight: 400;
  }

  .panel{
    background: var(--panel-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--panel-border);
    border-radius: 24px;
    padding: 24px 20px;
    margin: 0 auto 20px;
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
  }

  .panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
  }

  .section { 
    margin: 20px 0;
  }

  .section:first-child {
    margin-top: 0;
  }

  .label {
    font-size: 14px;
    color: var(--text-medium);
    margin-bottom: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .label::before {
    content: '‚ô™';
    color: var(--primary);
    font-size: 16px;
  }

  .bpm-section {
    text-align: center;
    padding: 20px 0;
  }

  .bpm-display {
    font-size: 48px;
    font-weight: 800;
    color: var(--primary-dark);
    margin: 16px 0;
    text-shadow: 0 2px 4px rgba(200, 162, 200, 0.2);
  }

  .bpm-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 20px;
  }

  .bpm-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    font-size: 28px;
    font-weight: bold;
    box-shadow: var(--shadow-small);
    transition: all 0.2s ease;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .bpm-btn:active {
    transform: scale(0.95);
    box-shadow: 0 2px 8px rgba(200, 162, 200, 0.3);
  }

  .bpm-input {
    width: 120px;
    height: 50px;
    font-size: 24px;
    font-weight: 700;
    text-align: center;
    border: 2px solid var(--panel-border);
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.8);
    color: var(--text-dark);
    backdrop-filter: blur(5px);
  }

  .controls-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin: 20px 0;
  }

  .control-card {
    background: rgba(255, 255, 255, 0.6);
    border: 1px solid rgba(232, 180, 212, 0.2);
    border-radius: 16px;
    padding: 16px;
    backdrop-filter: blur(5px);
  }

  .control-pair {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
  }

  .control-input {
    flex: 1;
    height: 44px;
    font-size: 16px;
    font-weight: 600;
    text-align: center;
    border: 1px solid rgba(232, 180, 212, 0.3);
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.8);
    color: var(--text-dark);
  }

  .control-select {
    width: 100%;
    height: 44px;
    font-size: 16px;
    font-weight: 600;
    text-align: center;
    border: 1px solid rgba(232, 180, 212, 0.3);
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.8);
    color: var(--text-dark);
    margin-top: 8px;
  }

  .volume-section {
    padding: 16px 0;
  }

  .volume-slider {
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: linear-gradient(90deg, var(--secondary), var(--primary));
    appearance: none;
    outline: none;
    margin: 12px 0;
  }

  .volume-slider::-webkit-slider-thumb {
    appearance: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    box-shadow: var(--shadow-small);
    cursor: pointer;
  }

  .volume-slider::-moz-range-thumb {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    box-shadow: var(--shadow-small);
    cursor: pointer;
    border: none;
  }

  .kit-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin: 16px 0;
  }

  .kit-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 16px;
    background: rgba(255, 255, 255, 0.7);
    border: 1px solid rgba(232, 180, 212, 0.25);
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    backdrop-filter: blur(5px);
  }

  .kit-item:hover {
    background: rgba(255, 255, 255, 0.9);
    border-color: var(--primary);
  }

  .kit-item input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--primary);
  }

  .kit-item label {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-dark);
    cursor: pointer;
    flex: 1;
  }

  .play-controls {
    display: flex;
    gap: 16px;
    justify-content: center;
    margin-top: 32px;
    padding: 8px 0;
  }

  .play-btn {
    flex: 1;
    max-width: 140px;
    height: 56px;
    border: none;
    border-radius: 28px;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: var(--shadow-small);
  }

  .play-btn.start {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
  }

  .play-btn.stop {
    background: linear-gradient(135deg, #f44336, #da190b);
    color: white;
  }

  .play-btn:active {
    transform: scale(0.98);
  }

  .divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(232, 180, 212, 0.3), transparent);
    margin: 24px 0;
  }

  /* Unlock overlay */
  #unlockOverlay {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(250, 247, 244, 0.95);
    backdrop-filter: blur(10px);
    z-index: 9999;
    padding: 20px;
    transition: opacity 0.3s ease;
  }

  #unlockOverlay.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .unlock-card {
    background: var(--panel-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--panel-border);
    border-radius: 24px;
    padding: 32px 24px;
    text-align: center;
    max-width: 320px;
    box-shadow: var(--shadow);
  }

  .unlock-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 12px;
  }

  .unlock-message {
    font-size: 16px;
    color: var(--text-medium);
    margin-bottom: 24px;
    line-height: 1.5;
  }

  #unlock {
    width: 100%;
    height: 56px;
    border: none;
    border-radius: 28px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: var(--shadow-small);
    transition: all 0.2s ease;
  }

  #unlock:active {
    transform: scale(0.98);
  }

  /* Responsive adjustments */
  @media (max-width: 375px) {
    .app { padding-left: 16px; padding-right: 16px; }
    .bpm-display { font-size: 42px; }
    .controls-row { gap: 12px; }
    .kit-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
  <div class="piano-pattern"></div>
  
  <!-- Unlock overlay -->
  <div id="unlockOverlay">
    <div class="unlock-card">
      <div class="unlock-title">üéµ Èü≥Â£∞„ÇíÊúâÂäπÂåñ</div>
      <div class="unlock-message">„É°„Éà„É≠„Éé„Éº„É†„ÇíÈñãÂßã„Åô„Çã„Åü„ÇÅ„Å´<br>ÁîªÈù¢„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
      <button id="unlock">„Çø„ÉÉ„Éó„Åó„Å¶ÈñãÂßã</button>
    </div>
  </div>

  <div class="app">
    <div class="header">
      <h1 class="title">„Ç®„Éü„É™„Ç¢„Éî„Ç¢„ÉéÊïôÂÆ§</h1>
      <div class="subtitle">„É°„Éà„É≠„Éé„Éº„É†</div>
      <div class="author">Created by Êñ∞Áî∞„Éä„Ç™„Éü</div>
    </div>

    <div class="panel">
      <!-- BPM Section -->
      <div class="section bpm-section">
        <div class="label">„ÉÜ„É≥„Éù</div>
        <div class="bpm-display" id="bpmDisplay">100</div>
        <div class="bpm-controls">
          <button id="bpmMinus" class="bpm-btn">‚àí</button>
          <input id="bpm" class="bpm-input" type="number" value="100" min="20" max="300" />
          <button id="bpmPlus" class="bpm-btn">Ôºã</button>
        </div>
      </div>

      <div class="divider"></div>

      <!-- Time signature & subdivision -->
      <div class="controls-row">
        <div class="control-card">
          <div class="label">ÊãçÂ≠ê</div>
          <div class="control-pair">
            <input id="beats" class="control-input" type="number" value="4" min="1" max="12">
            <span style="color: var(--text-light); font-size: 20px;">/</span>
            <input id="beatUnit" class="control-input" type="number" value="4" min="1" max="32">
          </div>
        </div>
        <div class="control-card">
          <div class="label">Á¥∞ÂàÜ</div>
          <select id="subdiv" class="control-select">
            <option value="quarter">4ÂàÜÈü≥Á¨¶</option>
            <option value="eighth" selected>8ÂàÜÈü≥Á¨¶</option>
            <option value="triplet">3ÈÄ£Á¨¶</option>
            <option value="sixteenth">16ÂàÜÈü≥Á¨¶</option>
          </select>
        </div>
      </div>

      <!-- Volume -->
      <div class="section volume-section">
        <div class="label">Èü≥Èáè</div>
        <input id="volume" class="volume-slider" type="range" min="0" max="1" step="0.01" value="0.7">
      </div>

      <div class="divider"></div>

      <!-- Kit -->
      <div class="section">
        <div class="label">Ê•ΩÂô®„ÅÆÈÅ∏Êäû</div>
        <div class="kit-grid">
          <div class="kit-item">
            <input type="checkbox" id="kick" checked>
            <label for="kick">„Ç≠„ÉÉ„ÇØ</label>
          </div>
          <div class="kit-item">
            <input type="checkbox" id="snare" checked>
            <label for="snare">„Çπ„Éç„Ç¢</label>
          </div>
          <div class="kit-item">
            <input type="checkbox" id="hihat" checked>
            <label for="hihat">„Éè„Ç§„Éè„ÉÉ„Éà</label>
          </div>
          <div class="kit-item">
            <input type="checkbox" id="tamb">
            <label for="tamb">„Çø„É≥„Éê„É™„É≥</label>
          </div>
          <div class="kit-item">
            <input type="checkbox" id="shaker">
            <label for="shaker">„Ç∑„Çß„Ç§„Ç´„Éº</label>
          </div>
          <div class="kit-item">
            <input type="checkbox" id="conga">
            <label for="conga">„Ç≥„É≥„Ç¨</label>
          </div>
        </div>
      </div>

      <div class="play-controls">
        <button id="start" class="play-btn start">‚ñ∂ ÈñãÂßã</button>
        <button id="stop" class="play-btn stop">‚è∏ ÂÅúÊ≠¢</button>
      </div>
    </div>
  </div>

<script>
(() => {
  const el = (id) => document.getElementById(id);

  let ctx, master;
  function initAudio(){
    if (ctx) return ctx;
    ctx = new (window.AudioContext||window.webkitAudioContext)();
    master = ctx.createGain();
    master.gain.value = parseFloat(el('volume').value||'0.7');
    master.connect(ctx.destination);
    return ctx;
  }

  function unlockAudioNow(){
    initAudio();
    try{ ctx.resume(); }catch(e){}
    try{ 
      const s=ctx.createBufferSource(); 
      s.buffer=ctx.createBuffer(1,1,ctx.sampleRate); 
      s.connect(master); 
      s.start(0);
    }catch(e){}
    const ov = el('unlockOverlay'); 
    if (ctx && ctx.state==='running' && ov) {
      ov.classList.add('hidden');
    }
  }

  function playKick(t, vol=1){
    const o=ctx.createOscillator(), g=ctx.createGain();
    o.type='sine';
    o.frequency.setValueAtTime(160,t);
    o.frequency.exponentialRampToValueAtTime(55,t+0.10);
    g.gain.setValueAtTime(1.0*vol,t);
    g.gain.exponentialRampToValueAtTime(0.001,t+0.28);
    o.connect(g).connect(master); o.start(t); o.stop(t+0.32);
  }

  function playSnare(t, vol=1){
    const tone=ctx.createOscillator(), tg=ctx.createGain();
    tone.type='triangle';
    tone.frequency.setValueAtTime(190,t);
    tg.gain.setValueAtTime(0.25*vol,t);
    tg.gain.exponentialRampToValueAtTime(0.001,t+0.14);
    const n=ctx.createBufferSource(), b=ctx.createBuffer(1, ctx.sampleRate*0.20, ctx.sampleRate);
    const d=b.getChannelData(0); for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
    n.buffer=b; const hp=ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=1800;
    const ng=ctx.createGain(); ng.gain.setValueAtTime(0.8*vol,t); ng.gain.exponentialRampToValueAtTime(0.001,t+0.20);
    tone.connect(tg).connect(master);
    n.connect(hp).connect(ng).connect(master);
    tone.start(t); tone.stop(t+0.18);
    n.start(t); n.stop(t+0.2);
  }

  function playHihat(t, vol=1){
    const n=ctx.createBufferSource(); const b=ctx.createBuffer(1, ctx.sampleRate*0.04, ctx.sampleRate);
    const d=b.getChannelData(0); for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
    n.buffer=b; const hp=ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=7000;
    const g=ctx.createGain(); g.gain.setValueAtTime(0.6*vol,t); g.gain.exponentialRampToValueAtTime(0.01,t+0.05);
    n.connect(hp).connect(g).connect(master); n.start(t); n.stop(t+0.05);
  }

  function playTamb(t, vol=1){
    // Tambourine sound synthesis
    const n=ctx.createBufferSource(); 
    const b=ctx.createBuffer(1, ctx.sampleRate*0.15, ctx.sampleRate);
    const d=b.getChannelData(0); 
    for(let i=0;i<d.length;i++) {
      d[i]=(Math.random()*2-1) * Math.sin(i*0.02) * 0.3;
    }
    n.buffer=b; 
    const hp=ctx.createBiquadFilter(); 
    hp.type='highpass'; 
    hp.frequency.value=3000;
    const g=ctx.createGain(); 
    g.gain.setValueAtTime(0.4*vol,t); 
    g.gain.exponentialRampToValueAtTime(0.01,t+0.15);
    n.connect(hp).connect(g).connect(master); 
    n.start(t); 
    n.stop(t+0.15);
  }

  let bpmVal=100, beats=4, beatUnit=4, subdiv='eighth';
  let playing=false, step=0, nextTime=0;
  const ahead=0.14;

  function secPerStep(){
    const spb = 60 / bpmVal;
    const stepsPerBeat = subdiv==='quarter'?1:subdiv==='eighth'?2:subdiv==='triplet'?3:4;
    return spb * (4/beatUnit) / stepsPerBeat;
  }

  function scheduleStep(i, t){
    const stepsPerBeat = subdiv==='quarter'?1:subdiv==='eighth'?2:subdiv==='triplet'?3:4;
    const beatIndex = Math.floor(i/stepsPerBeat);
    const stepInBeat = i % stepsPerBeat;
    const beatInBar  = beatIndex % beats;

    // „Éè„Ç§„Éè„ÉÉ„Éà
    if (el('hihat').checked){
      const hhLevel = (stepInBeat===0) ? 0.75 : 0.50;
      playHihat(t, hhLevel);
    }

    if (stepInBeat===0){
      if (el('snare').checked && (beatInBar===1 || beatInBar===3)){
        playSnare(t, beatInBar===1 ? 0.95 : 0.90);
      }
      if (el('kick').checked && (beatInBar===0 || beatInBar===2)){
        playKick(t, beatInBar===0 ? 1.00 : 0.90);
      }
      if (el('tamb').checked && beatInBar === 0) {
        playTamb(t, 0.6);
      }
    }
  }

  function scheduler(){
    while(nextTime < ctx.currentTime + ahead){
      scheduleStep(step, nextTime);
      nextTime += secPerStep();
      step++;
    }
    if (playing) requestAnimationFrame(scheduler);
  }

  function updateBpmDisplay() {
    el('bpmDisplay').textContent = el('bpm').value;
  }

  function start(){
    if (!ctx || ctx.state!=='running') unlockAudioNow();
    bpmVal = parseInt(el('bpm').value||'100',10);
    beats  = parseInt(el('beats').value||'4',10);
    beatUnit = parseInt(el('beatUnit').value||'4',10);
    subdiv = (el('subdiv').value||'eighth');
    playing=true; step=0; nextTime=ctx.currentTime+0.05;
    scheduler();
  }

  function stop(){ 
    playing=false; 
  }

  // Event listeners
  const unlockBtn = el('unlock');
  if (unlockBtn){
    unlockBtn.addEventListener('click', unlockAudioNow);
    unlockBtn.addEventListener('touchend', unlockAudioNow);
  }

  document.addEventListener('pointerdown', ()=>{
    if(!ctx || ctx.state!=='running') unlockAudioNow();
  });

  el('start').addEventListener('click', start);
  el('stop').addEventListener('click', stop);

  el('bpmMinus').addEventListener('click', ()=>{ 
    const newVal = Math.max(20, parseInt(el('bpm').value||'100',10)-1);
    el('bpm').value = newVal;
    updateBpmDisplay();
  });
  
  el('bpmPlus').addEventListener('click', ()=>{ 
    const newVal = Math.min(300, parseInt(el('bpm').value||'100',10)+1);
    el('bpm').value = newVal;
    updateBpmDisplay();
  });

  el('bpm').addEventListener('input', updateBpmDisplay);

  el('volume').addEventListener('input', (e)=>{
    if(master) master.gain.value=parseFloat(e.target.value||'0.7');
  });

  // Initialize display
  updateBpmDisplay();
})();
</script>
</body>
</html>
